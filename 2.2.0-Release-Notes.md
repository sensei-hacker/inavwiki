**Hello and welcome to INAV 2.2.0 Release!**

Please carefully read all of this document for the best possible experience and safety.

Get in touch with other pilots, share experiences, suggestions and ask for help on:

<table>
  <tbody>
    <tr>
      <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/1024px-Telegram_logo.svg.png" width="48"></td>
      <td><a href="https://t.me/INAVFlight">INAV Official on Telegram</a></td>
    </tr>
    <tr>
      <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Facebook_logo_%28square%29.png/600px-Facebook_logo_%28square%29.png" width="48"></td>
      <td><a href="https://www.facebook.com/groups/INAVOfficial">INAV Official on Facebook</a></td>
    </tr>
  </tbody>
</table>

Support developers for free by checking out from the following stores after having clicked on the following links:

<table>
  <tbody>
    <tr>
      <td><img src="https://lh3.googleusercontent.com/TiHXyUiZ2COk7OmceBgo1qeRN2APAjWL5qUydGc-U3LqkJb3n13EhYEJ8Dpz_IACNHU" width="55"></td>
      <td><a href="https://inavflight.com/shop/u/bg">Support us on Banggood</a></td>
    </tr>
  </tbody>
</table>

Tested and suggested hardware can be found [here](https://github.com/iNavFlight/inav/wiki/Welcome-to-INAV,-useful-links-and-products) 

## Important Notes

1. Arming with sticks is being removed since it is not safe to use. Use switch arming.

## Upgrading from 2.1.0

1. Stick arming warning, add switch to arm
## New targets:

* MAMBA F405
* OMNIBUSF4V3_SFTSRL2 (OMNIBUSF4V3 with two software serial)


## CLI:

### New

| Setting | Description |
| ----    | ------ |
| `acc_lpf_type ` | Specifies the type of the software LPF of the acc signals. BIQUAD gives better filtering and more delay, PT1 less filtering and less delay, so use only on clean builds. |
| `nav_mc_pos_deceleration_time` | Used for stoping distance calculation. Stop position is computed as _speed_ * _nav_mc_pos_deceleration_time_ from the place where sticks are released. Braking mode overrides this setting |
| `nav_mc_pos_expo` | Expo for PosHold control |
| `use_dterm_fir_filter`||

### Removed

| Setting | Description |
| ----    | ------ |
| `placeholder` | |

## STM32F7 optimizations

INAV 2.2 offers a huge performance boost for all F7 based flight controllers (STM32F745 and STM32F722). Thanks to using both fast _Instruction_ and _Data_ memory (**ITCM** and **DTCM**), INAV on F7 boards is as fast as on F4 boards. Special thanks to @diehertz for helping and original work for Betaflight. With performance fixes, INAV 2.2 is now capable of running 8kHz PID loop. 

> It is still not advised to use 8kHz when any I2C devices are connected to flight controller (**BOTH F4 and F7**). This specially applies to **Magnetometer** and **Barometer**. Because I2C bus driver is synchronous and the process or reading data for MAG or BARO takes longer than time available between PID loop cycles, jitter will appear. 

If **I2C** magnetometer or barometer are to be used, switch to 4kHz mode!

## Logic Conditions

**Logic conditions** is a new function framework that in INAV 2.2 allows to activate and deactivate specific servo mixer rules.

Logic conditions can evaluate RC channels, flight parameters, and other logic conditions into true/false and activate/deactivate servo mixer rules. It opens possibilities like:
* automatically deploy flaps when speed is too low
* activate servo when distance or altitude has been reached
* flaps/spoilers with different throws

Future versions of INAV will allow using **Logic conditions** to switch motor mixer banks and make other overrides that currently cannot be changed during flight or be activated by flight conditions 

## Main changes

### PLACEHOLDER
* PLACEHOLDER ([@fiam] [@giacomo892], [#2450] [#3522])

## All changes:

* New mixer inputs for stabilized axises  ([@DzikuVx] , [#4148])
* STM32F7 Optimizations  ([@DzikuVx] , [#4263], [#4483])
* LTM Improvements ([@stronnag] ,[#4423])
* Temperature Sensing Improvements ([@shellixyz] ,[#4416])
* Optimizing CMS to save FLASH ([@fiam] ,[#4380])
* Enforcing Board Allignment Limits  ([@fiam] ,[#4420])
* Logic conditions framework ([@DzikuVx] , [#4144], [#4561], [#4555], [#4551])
* MSP on VPC Fixes  ([@digitalentity] ,[#4468])
* PT1 Filter option for Acc/Gyro ([@giacomo892] ,[#4454],[#4676])
* Use imperial units for altitude for UK ([@shellixyz] ,[#4445])
* Convert NAV POS/VEL PID to PIDFF ([@DzikuVx] , [#4326], [#4624])
* PH Settings aren't anymore inside PID conf. but have dedicated settings ([@DzikuVx] , [#4484])
* Fixed Wing FF PIDFF setting now is no more "D" in the configurator ([@DzikuVx] , [#4482])
* Make Dterm FIR filter configurable ([@DzikuVx] , [#4475] ,  [#4538])
* Update temperature related MSP messages  ([@shellixyz] ,[#4449])
* Set default home reset to FIRST ARM ([@DzikuVx] , [#4499])
* Added Servo output logging in BB ([@hali9] , [#4501])
* Fixing the left-right arrow mismatch in the OSD fonts ([@OlivierC-FR] , [#4502])
* Add dedicated OSD elements for map scale and reference ([@fiam] ,[#4386])
* Manage WPs from CLI ([@hali9] , [#4473])
* Remove all MAX7456 specific code, replace it with generic interfaces ([@fiam] ,[#4384])
* Refactor handling of RC input data  ([@fiam] ,[#4232])
* Replace DEBUG_TRACE with LOG ([@fiam] ,[#4385])
* Add MAMBAF405 target ([@shellixyz] ,[#4521])
* Fix emergency landing not engaging from initial RTH climb ([@digitalentity] ,[#4582])
* SmartAudio 2.1 Support ([@digitalentity] ,[#4596])
* DSHOT Timers Fixes ([@digitalentity] ,[#4607])
* GPS distance from home can be > 65km ([@giacomo892] ,[#4617])
* OMNIBUSF4V3_SFTSRL2 target ([@shellixyz] ,[#4626])
* Iterm Relax ([@DzikuVx] , [#4630])
* Remove Sticks  Arming ([@DzikuVx] , [#4640])
* serial CLI command improvements (+n -n)  ([@fiam] ,[#4232])
* Support for bypassing extra arming safety  ([@fiam] ,[#4623])
* Airmode improvements ([@DzikuVx] , [#4634])
* Optic flow & surface improvements ([@digitalentity] ,[#3795],[#4680])
* Ignore acceleration in estimated position when clipping or high vibration ([@digitalentity] ,[#4681])
* Implement RTH Straight ([@shellixyz] ,[#4188])

[@digitalentity]: https://github.com/digitalentity
[@DzikuVx]: https://github.com/DzikuVx
[@eephyne]: https://github.com/eephyne
[@fiam]: https://github.com/fiam
[@giacomo892]: https://github.com/giacomo892
[@hali9]: https://github.com/hali9
[@nmaggioni]: https://github.com/nmaggioni
[@nyway]: https://github.com/nyway
[@shellixyz]: https://github.com/shellixyz
[@stronnag]: https://github.com/stronnag
[@mluessi]: https://github.com/mluessi
[@Garogat]: https://github.com/Garogat
[@teckel12]: https://github.com/teckel12
[@bnn1044]: https://github.com/bnn1044
[@krzysztofmatula]: https://github.com/krzysztofmatula
[@danarrib]: https://github.com/danarrib
[@marbalon]: https://github.com/marbalon
[@OlivierC-FR]: https://github.com/OlivierC-FR

[#4148]: https://github.com/iNavFlight/inav/pull/4180
[#4263]: https://github.com/iNavFlight/inav/pull/4263
[#4483]: https://github.com/iNavFlight/inav/pull/4483
[#4423]: https://github.com/iNavFlight/inav/pull/4423
[#4416]: https://github.com/iNavFlight/inav/pull/4416
[#4380]: https://github.com/iNavFlight/inav/pull/4380
[#4420]: https://github.com/iNavFlight/inav/pull/4420
[#4144]: https://github.com/iNavFlight/inav/pull/4144
[#4561]: https://github.com/iNavFlight/inav/pull/4561
[#4555]: https://github.com/iNavFlight/inav/pull/4555
[#4551]: https://github.com/iNavFlight/inav/pull/4551
[#4468]: https://github.com/iNavFlight/inav/pull/4468
[#4454]: https://github.com/iNavFlight/inav/pull/4454
[#4676]: https://github.com/iNavFlight/inav/pull/4676
[#4445]: https://github.com/iNavFlight/inav/pull/4445
[#4326]: https://github.com/iNavFlight/inav/pull/4326
[#4624]: https://github.com/iNavFlight/inav/pull/4624
[#4484]: https://github.com/iNavFlight/inav/pull/4484
[#4482]: https://github.com/iNavFlight/inav/pull/4482
[#4475]: https://github.com/iNavFlight/inav/pull/4475
[#4449]: https://github.com/iNavFlight/inav/pull/4449
[#4499]: https://github.com/iNavFlight/inav/pull/4499
[#4501]: https://github.com/iNavFlight/inav/pull/4501
[#4502]: https://github.com/iNavFlight/inav/pull/4502
[#4386]: https://github.com/iNavFlight/inav/pull/4386
[#4473]: https://github.com/iNavFlight/inav/pull/4473
[#4384]: https://github.com/iNavFlight/inav/pull/4384
[#4384]: https://github.com/iNavFlight/inav/pull/4384
[#4385]: https://github.com/iNavFlight/inav/pull/4385
[#4521]: https://github.com/iNavFlight/inav/pull/4521
[#4538]: https://github.com/iNavFlight/inav/pull/4538
[#4582]: https://github.com/iNavFlight/inav/pull/4582
[#4607]: https://github.com/iNavFlight/inav/pull/4607
[#4596]: https://github.com/iNavFlight/inav/pull/4596
[#4617]: https://github.com/iNavFlight/inav/pull/4617
[#4626]: https://github.com/iNavFlight/inav/pull/4626
[#4630]: https://github.com/iNavFlight/inav/pull/4630
[#4640]: https://github.com/iNavFlight/inav/pull/4640
[#4232]: https://github.com/iNavFlight/inav/pull/4232
[#4623]: https://github.com/iNavFlight/inav/pull/4623
[#4634]: https://github.com/iNavFlight/inav/pull/4634
[#3795]: https://github.com/iNavFlight/inav/pull/3795
[#4680]: https://github.com/iNavFlight/inav/pull/4680
[#4681]: https://github.com/iNavFlight/inav/pull/4681
[#4188]: https://github.com/iNavFlight/inav/pull/4188
