
## WARNINGS

**DO NOT RESTORE ACCELEROMETER CALIBRATION VALUES FROM AN OLDER RELEASE (<2.0)** Doing that will led to poor attitude estimation performance and may cause troubles.

When upgrading a full chip erase (when flashing) / `defaults` from CLI is advised. Be sure to backup your configuration and restore it wisely.

OSD layout configuration from releases < 2.0 is not compatible with the current one. Take a screenshot of your current OSD layout before upgrading and restore it manually from the configurator.

`current_meter_offset` setting changed scale. Need to be multiplied by 10 if it's value is coming from < INAV 2.0.0 

**STM32F1 boards support has been dropped. NAZE/CC3D targets are no longer supported.** Please upgrade to F4/F7 board. F3 boards are not recommended since their flash space is almost full and they are likely to not receive all features on the next release.

## Upgrading from 1.9.X

1. Be sure to run the latest INAV 2.0 Configuration release. Download from [here]
2. Go to the CLI tab and copy and paste the `diff` output to a text file for later usage. 
3. Go to the OSD tab and take a screenshot of the current layout
4. Flash INAV 2.0 enabling **full chip erase** . Now you FC should run INAV 2.0. Connect again and check firmware version.
5. Go to the Mixer tab and load and apply your desidered mixer.
6. Go back to your configuration text file and delete all lines starting with: mixer acczero accgain magzero osd. 
7. Open the CLI tab in the configurator and paste your cleaned up configuration in the text box and type `save` and press enter. The flight controller will now reboot.
8. Calibrate the accelerometer following the steps in the dedicated tab. Only first two steps needs to be made in the right order.
9. Calibration of the magnetometer should be done at the field. The magnetic field indoors can be distorted and led to a bad calibration.
10. Restore manually your OSD layout using the screenshot and upload the font you like using the dedicated button.
11. Carefully check all the configuration and check on the bench without installed propellers if everything looks good. In particular check if the model preview behave correctly when you are moving your model and check surfaces movements for an airplane.
12. Enjoy INAV 2.0.0 and explore it's new features!

## Walk through if TL;DR

[https://www.youtube.com/watch?v=sHvItS2qKfk](https://www.youtube.com/watch?v=sHvItS2qKfk)

## Known bugs

* none yet

## New mixer and mixer GUI

Starting from INAV 2.0.0, there are no predefined mixers on the firmware side: CLI command `mixer QUADX` will just not work. Mixer has to be configured using INAV Configurator 2.0 with __Mixer__ tab.

Restoring from previous releases via CLI will not work correctly. Please use _Configurator 2.0_ mixer tab to configure it from scratch.

See [https://www.youtube.com/watch?v=0cLFu-5syi0](https://www.youtube.com/watch?v=0cLFu-5syi0) 

## Added `NAV CRUISE` flight mode (fixed wing)

This release introduces the new `NAV CRUISE` flight mode. When enabled the machine will try to maintain the current heading and compensate for any external disturbances (2D CRUISE). User can adjust the flight direction directly with ROLL stick or with the YAW stick ( `nav_fw_cruise_yaw_rate` set the yawing rate at full stick deflection ). The latter will offer a smoother way to adjust the flight direction. If the mode is enabled in conjunction with `NAV ALTHOLD` also the current altitude will be maintained (3D CRUISE). Altitude can be adjusted, as usual, via the pitch stick.

## OSD improvements

OSD functionally got overhauled and improved. Now it is possible to have three OSD layouts and switch between them via an RC channel. Furthermore new two modes have been added: `map` and `radar`.

* `map` mode draws the home centered, while the craft moves around. There are two available maps: one with the North pointing up and another one with the takeoff direction pointing up.
* `radar` mode draws the craft in the center and the home moving around.

Those modes will enable the display of other aircraft flying in the vicinity in a future releases.

## CLI parameter renaming / new parameters

| Name               | Description                                                    |
|------------------------|----------------------------------------------------------------|
| `nav_fw_cruise_yaw_rate` |  Max YAW rate when NAV CRUISE mode is enabled (0=disable control via yaw stick) [dps] |
| `gyro_stage2_lowpass_hz`	| Software based second stage lowpass filter for gyro. Value is cutoff frequency (Hz). Currently experimental
| `name`  | The craft name is now a `set` value. `name MYCRAFT` is replaced by `set name = MYCRAFT`.
| `switch_disarm_delay` | Defines a delay for switch disarming setting (default 150ms, PR #3118) **For better safety, a value of at least 250ms is recommended**
| `inav_reset_home` | Defines when the home position is automatically reset, default is `EACH_ARM`. Allowed values: `NEVER`, `FIRST_ARM`, `EACH_ARM`
| `model_preview_type`  | Defines the aircraft type. This is advisory for display purposes only (Configurator, Ground Control Stations) and has no affect on aircraft behaviour. This setting takes the numeric values equivalent to the old 'mixer'.
| `platform_type` | Defines the aircraft (vehicle) type. This value affects the vehicle performance. Default is `MULTIROTOR`, allowed values: `MULTIROTOR`, `AIRPLANE`, `HELICOPTER`, `TRICOPTER`, `ROVER`, `BOAT`. Only `MULTIROTOR`, `AIRPLANE` and `TRICOPTER` are implemented in iNav 2.0.

## New boards

* Added support for MATEKF411 mini and MATEKF411-WING ([@fiam], [#3146])
* Added support for DALRCF405 ([@nyway], [#3184])

## New features

* Added support for wind estimation on fixed wing aircrafts ([@fiam], [#2450])
* Added support for multiple OSD layouts, make all OSD items and alarms configurable via CMS ([@fiam], [#2955] [#3264])
* Added Automatic Daylight Saving Time support ([@nmaggioni], [#3072] [#3262])
* Added Map and Radar modes to OSD ([@fiam], [#3178] [#3196] [#3241])
* New SBUS driver compatible with FrSky R9 receivers ( [@digitalentity] ,  [#3110] )
* Gyro stage 2 filter (FIR2) ported from Betaflight ( [@DzikuVx] ,  [#3191] [#3208] )
* __Experimental__ Terrain Following mode (aka `SURFACE` mode). If `AltHold` mode is enabled together with `SURFACE` mode, UAV will try to keep ground altitude reported by rangefinder instead of baro/GPS absolute altitude. ([@digitalentity], [#3202])
* __Experimental__ OPFLOW mode, which allows navigation for by tracking the floor rather than using GPS ([@digitalentity], [#3164])
* Added `NAV CRUISE` flight mode (fixed wing) ( [@giacomo892] , [@shellixyz] ,  [#3311])


## Improvements

* Add driver for BOSCH BMI180 gyro ([@digitalentity], [#2951])
* Multirotor acro performance improved ( [@digitalentity] , [#2893] )
* Mixer refactoring - FC is now unaware of anything besides mixer rules ( [@DzikuVx] , [#2978] )
* Added support for IST8308 compass ([@McGiverGim], [#3039])
* Fixed wing Autotrim does not dive /climb /roll  after Autotrim is done ( [@DzikuVx] , [#3104] )
* Refactor timer drivers to simplify target definitions ([@digitalentity], [#3120])
* Make the delay for disarming via switch configurable ([@digitalentity], [#3118])
* Add `watts` symbol to OSD font ([@alexeystn], [#3132])
* Make cell count detection more robust ([@shellixyz], [#3166])
* Add pitch and roll angles to the OSD ([@shellixyz], [#3169])
* Prepend home icon to the distance to home in the OSD ([@fiam], [#3173])
* Add new parameter for controlling how the home position is reset ([@fiam], [#3183])
* Add driver for LPS25HB barometers ([@digitalentity], [#3192])
* Configure accelerometers in 16G mode ([@digitalentity], [#3203])
* Send GPS related sensors via Smarport and FPort even before a GPS fix is acquired ([@fiam], [#3207])
* Increase maximum value displayed by the OSD efficiency indicator ([@shellixyz], [#3237])
* Added support for limiting throttle rate ([@digitalentity], [#3257])
* It is no longer necessary to use `smix reverse` to reverse a tricopter tail servo; this can be done in the 2.0 Configurator or with the CLI `smix 0 5 2 -100 0`


## Removed features:

* Feature `CHANNEL_FORWARDING` has been removed, it can be implemented using new mixer GUI in Configurator
* Feature `SERVO_GIMBAL` has been removed, it can be implemented using new mixer GUI in Configurator
* The `mid_rc` CLI variable has been removed, and the setting removed from the configurator. If necessary (e.g.Futaba TX), the same effect can be achieved using `rxrange` settings.

## Bugfixes

* Prevent out of time ARMED message in the OSD when arming with the OSD disabled ([@shellixyz], [#3098])
* Allow using CMS while OSD is disabled ([@shellixyz], [#3099])
* Fix current sensor overflow ([@shellixyz], [#3131])
* Remove YAW inversion in 3D mode for vehicles that don't need it ([@eephyne], [#3128])
* Fix vertical alignment of ARMED screen in OSD when using NTSC ([@fiam], [#3149])
* Make the total trip distance OSD item work when no current sensor is present ([@shellixyz], [#3163])
* Fix "sensor lost" problems when using FPort telemetry ([@fiam], [#3206])
* Fix outputs 5 and 6 in SPRACINGF3 ([@shellixyz], [#3236])
* Fix logging of negative altitudes in BlackBox logs ([@stronnag], [#3250])
* Properly round servo values after applying servo filtering ([@fiam], [#3276])
* Avoid to delete navigation modes if MAG is not available ([@shellixyz], [#2984])

## Developer Notes

Due to a beneficial change in the build environment (generated files are stored per target, not in a common area), it is necessary to remove a couple of files from any older branches (these files are generated automatically by the build).
```
# on a Posix O/S
rm -f src/main/fc/settings_generated.[ch]
```

[@alexeystn]: https://github.com/alexeystn
[@digitalentity]: https://github.com/digitalentity
[@DzikuVx]: https://github.com/DzikuVx
[@eephyne]: https://github.com/eephyne
[@fiam]: https://github.com/fiam
[@giacomo892]: https://github.com/giacomo892
[@hali9]: https://github.com/hali9
[@nmaggioni]: https://github.com/nmaggioni
[@nyway]: https://github.com/nyway
[@shellixyz]: https://github.com/shellixyz
[@stronnag]: https://github.com/stronnag

[#2450]: https://github.com/iNavFlight/inav/pull/2450
[#2893]: https://github.com/iNavFlight/inav/pull/2893
[#2951]: https://github.com/iNavFlight/inav/pull/2951
[#2955]: https://github.com/iNavFlight/inav/pull/2955
[#2978]: https://github.com/iNavFlight/inav/pull/2978
[#2995]: https://github.com/iNavFlight/inav/pull/2995
[#3039]: https://github.com/iNavFlight/inav/pull/3039
[#3072]: https://github.com/iNavFlight/inav/pull/3072
[#3098]: https://github.com/iNavFlight/inav/pull/3098
[#3099]: https://github.com/iNavFlight/inav/pull/3099
[#3104]: https://github.com/iNavFlight/inav/pull/3104
[#3110]: https://github.com/iNavFlight/inav/pull/3110
[#3118]: https://github.com/iNavFlight/inav/pull/3118
[#3120]: https://github.com/iNavFlight/inav/pull/3120
[#3128]: https://github.com/iNavFlight/inav/pull/3128
[#3131]: https://github.com/iNavFlight/inav/pull/3131
[#3132]: https://github.com/iNavFlight/inav/pull/3132
[#3146]: https://github.com/iNavFlight/inav/pull/3146
[#3149]: https://github.com/iNavFlight/inav/pull/3149
[#3163]: https://github.com/iNavFlight/inav/pull/3163
[#3164]: https://github.com/iNavFlight/inav/pull/3164
[#3166]: https://github.com/iNavFlight/inav/pull/3166
[#3169]: https://github.com/iNavFlight/inav/pull/3169
[#3173]: https://github.com/iNavFlight/inav/pull/3173
[#3178]: https://github.com/iNavFlight/inav/pull/3178
[#3183]: https://github.com/iNavFlight/inav/pull/3183
[#3184]: https://github.com/iNavFlight/inav/pull/3184
[#3191]: https://github.com/iNavFlight/inav/pull/3191
[#3192]: https://github.com/iNavFlight/inav/pull/3192
[#3196]: https://github.com/iNavFlight/inav/pull/3196
[#3202]: https://github.com/iNavFlight/inav/pull/3202
[#3203]: https://github.com/iNavFlight/inav/pull/3203
[#3206]: https://github.com/iNavFlight/inav/pull/3206
[#3207]: https://github.com/iNavFlight/inav/pull/3207
[#3208]: https://github.com/iNavFlight/inav/pull/3208
[#3236]: https://github.com/iNavFlight/inav/pull/3236
[#3237]: https://github.com/iNavFlight/inav/pull/3237
[#3241]: https://github.com/iNavFlight/inav/pull/3241
[#3250]: https://github.com/iNavFlight/inav/pull/3250
[#3257]: https://github.com/iNavFlight/inav/pull/3257
[#3262]: https://github.com/iNavFlight/inav/pull/3262
[#3264]: https://github.com/iNavFlight/inav/pull/3264
[#3276]: https://github.com/iNavFlight/inav/pull/3276
[#3311]: https://github.com/iNavFlight/inav/pull/3311 
[#2984]: https://github.com/iNavFlight/inav/pull/2984

[here]: https://github.com/iNavFlight/inav-configurator/releases

