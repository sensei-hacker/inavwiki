
## WARNINGS

**DO NOT RESTORE ACCELEROMETER CALIBRATION VALUES FROM AN OLDER RELEASE (<2.0)** Doing that will led to poor attitude estimation performance and may cause troubles.

When upgrading a full chip erase (when flashing) / `defaults` from CLI is advised. Be sure to backup your configuration and restore it wisely.

OSD layout configuration from releases < 2.0 is not compatible with the current one. Take a screenshot of your current OSD layout before upgrading and restore it manually from the configurator.

**STM32F1 boards support has been dropped. NAZE/CC3D targets are no longer supported.** Please upgrade to F4/F7 board. F3 boards are not recommended since their flash space is almost full and they are likely to not receive all features on the next release.

## Walk through if TL;DR

[https://www.youtube.com/watch?v=sHvItS2qKfk](https://www.youtube.com/watch?v=sHvItS2qKfk)

## Known bugs

* none yet

## New mixer and mixer GUI

Starting from INAV 2.0.0, there are no predefined mixers on the firmware side: CLI command `mixer QUADX` will just not work. Mixer has to be configured using INAV Configurator 2.0 with __Mixer__ tab.

Restoring from previous releases via CLI will not work correctly. Please use _Configurator 2.0_ mixer tab to configure it from scratch.

See [https://www.youtube.com/watch?v=0cLFu-5syi0](https://www.youtube.com/watch?v=0cLFu-5syi0) 

## Added `NAV CRUISE` flight mode (fixed wing)

This release introduces the new `NAV CRUISE` flight mode. When enabled the machine will try to maintain the current heading and compensate for any external disturbances (2D CRUISE). User can adjust the flight direction directly with ROLL stick or with the YAW stick ( `nav_fw_cruise_yaw_rate` set the yawing rate at full stick deflection ). The latter will offer a smoother way to adjust the flight direction. If the mode is enabled in conjunction with `NAV ALTHOLD` also the current altitude will be maintained (3D CRUISE). Altitude can be adjusted, as usual, via the pitch stick.

## OSD improvements

OSD functionally got overhauled and improved. Now it is possible to have three OSD layouts and switch between them via an RC channel. Furthermore new two modes have been added: `map` and `radar`.

* `map` mode draws the home centered, while the craft moves around. There are two available maps: one with the North pointing up and another one with the takeoff direction pointing up.
* `radar` mode draws the craft in the center and the home moving around.

Those modes will enable the display of other aircraft flying in the vicinity in a future releases.

## CLI parameter renaming / new parameters

| Name               | Description                                                    |
|------------------------|----------------------------------------------------------------|
| `nav_fw_cruise_yaw_rate` |  Max YAW rate when NAV CRUISE mode is enabled (0=disable control via yaw stick) [dps] |
| `gyro_stage2_lowpass_hz`	| Software based second stage lowpass filter for gyro. Value is cutoff frequency (Hz). Currently experimental
| `name`  | The craft name is now a `set` value. `name MYCRAFT` is replaced by `set name = MYCRAFT`.
| `switch_disarm_delay` | Defines a delay for switch disarming setting (default 150ms, PR #3118) **For better safety, a value of at least 250ms is recommended**
| `inav_reset_home` | Defines when the home position is automatically reset, default is `EACH_ARM`. Allowed values: `NEVER`, `FIRST_ARM`, `EACH_ARM`
| `model_preview_type`  | Defines the aircraft type. This is advisory for display purposes only (Configurator, Ground Control Stations) and has no affect on aircraft behaviour. This setting takes the numeric values equivalent to the old 'mixer'.
| `platform_type` | Defines the aircraft (vehicle) type. This value affects the vehicle performance. Default is `MULTIROTOR`, allowed values: `MULTIROTOR`, `AIRPLANE`, `HELICOPTER`, `TRICOPTER`, `ROVER`, `BOAT`. Values other than `MULTIROTOR`, `AIRPLANE` and `TRICOPTER` are unsupported / highly experimental.

## New boards

* Added support for MATEKF411 mini and MATEKF411-WING ([@fiam], [#3146])
* Added support for DALRCF405 ([@nyway], [#3184])

## New features

* Added support for multiple OSD layouts, make all OSD items configurable via CMS ([@fiam], [#2955])
* Added OSD Map mode ([@fiam], [#3178])
* Added OSD Radar mode [@fiam], [#3196])
* New SBUS driver compatible with FrSky R9 receivers ( [@digitalentity] ,  [#3110] )
* Gyro stage 2 filter (FIR2) ported from Betaflight ( [@DzikuVx] ,  [#3191] [#3208] )
* __Experimental__ Terrain Following mode (aka `SURFACE` mode). If `AltHold` mode is enabled together with `SURFACE` mode, UAV will try to keep ground altitude reported by rangefinder instead of baro/GPS absolute altitude.  [#3202]
* __Experimental__ OPFLOW mode, which allows navigation for by tracking the floor rather than using GPS ([@digitalentity], [#3164])
* Added `NAV CRUISE` flight mode (fixed wing) ( [@giacomo892] , [@shellixyz] ,  [#3311])  

## Improvements

* Add driver for BOSCH BMI180 gyro ([@digitalentity], [#2951])
* Multirotor acro performance improved ( [@digitalentity] , [#2893] )
* Mixer refactoring - FC is now unaware of anything besides mixer rules ( [@DzikuVx] , [#2978] )
* Added support for IST8308 compass ([@McGiverGim], [#3039])
* Fixed wing Autotrim does not dive /climb /roll  after Autotrim is done ( [@DzikuVx] , [#3104] )
* Make the delay for disarming via switch configurable ([@digitalentity], [#3118])
* Add `watts` symbol to OSD font ([@alexeystn], [#3132])
* Make cell count detection more robust ([@shellixyz], [#3166])
* Add pitch and roll angles to the OSD ([@shellixyz], [#3169])
* Prepend home icon to the distance to home in the OSD ([@fiam], [#3173])
* Add new parameter for controlling how the home position is reset ([@fiam], [#3183])
* Add driver for LPS25HB barometers ([@digitalentity], [#3192])
* Configure accelerometers in 16G mode ([@digitalentity], [#3203])
* Send GPS related sensors via Smarport and FPort even before a GPS fix is acquired ([@fiam], [#3207])
* It is no longer necessary to use `smix reverse` to reverse a tricopter tail servo; this can be done in the 2.0 Configurator or with the CLI `smix 0 5 2 -100 0`


## Removed features:

* Feature `CHANNEL_FORWARDING` has been removed, it can be implemented using new mixer GUI in Configurator
* Feature `SERVO_GIMBAL` has been removed, it can be implemented using new mixer GUI in Configurator

## Bugfixes

* Prevent out of time ARMED message in the OSD when arming with the OSD disabled ([@shellixyz], [#3098])
* Allow using CMS while OSD is disabled ([@shellixyz, [#3099])
* Fix current sensor overflow ([@shellixyz], [#3131])
* Remove YAW inversion in 3D mode for vehicles that don't need it ([@eephyne], [#3128])
* Fix vertical alignment of ARMED screen in OSD when using NTSC ([@fiam], [#3149])
* Make the total trip distance OSD item work when no current sensor is present ([@shellixyz], [#3163])
* Fix "sensor lost" problems when using FPort telemetry ([@fiam], [#3206])


[@alexeystn]: https://github.com/alexeystn
[@digitalentity]: https://github.com/digitalentity
[@DzikuVx]: https://github.com/DzikuVx 
[@fiam]: https://github.com/fiam
[@giacomo892]: https://github.com/giacomo892
[@hali9]: https://github.com/hali9
[@shellixyz]: https://github.com/shellixyz
[@stronnag]: https://github.com/stronnag

[#3146]: https://github.com/iNavFlight/inav/pull/3146
[#3311]: https://github.com/iNavFlight/inav/pull/3311 
[#2978]: https://github.com/iNavFlight/inav/pull/2978

## Developer Notes

Due to a beneficial change in the build environment (generated files are stored per target, not in a common area), it is necessary to remove a couple of files from any older branches (these files are generated automatically by the build).
```
# on a Posix O/S
rm -f src/main/fc/settings_generated.[ch]
```