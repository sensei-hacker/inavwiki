Hello and welcome to INAV 2.1.0 Release!

Please carefully read all of this document for the best possible experience and safety.

Get in touch with other pilots, share experiences, suggestions and ask for help on:

<table>
  <tbody>
    <tr>
      <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/1024px-Telegram_logo.svg.png" width="48"></td>
      <td><a href="https://t.me/INAVFlight">INAV Official on Telegram</a></td>
    </tr>
    <tr>
      <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Facebook_logo_%28square%29.png/600px-Facebook_logo_%28square%29.png" width="48"></td>
      <td><a href="https://www.facebook.com/groups/INAVOfficial">INAV Official on Facebook</a></td>
    </tr>
  </tbody>
</table>

## Important Notes

## Upgrading from 2.0.0

1. Be sure to run the latest INAV 2.1 Configuration release. Download from [here](https://github.com/iNavFlight/inav-configurator/releases)
2. Go to the CLI tab and copy and paste the `diff` output to a text file for later usage. 
3. Flash INAV 2.1.0 enabling **full chip erase** . Now you FC should run INAV 2.1.0 Connect again and check the firmware version.
4. Go to CLI tab and paste all the contents you previously saved into a text file and press enter. Wait for it to finish. Type `save` and you should be good to go!
12. Enjoy INAV 2.1.0 and explore its new features!

## Upgrading from 1.9.X

1. Be sure to run the latest INAV 2.1 Configuration release. Download from [here]
2. Go to the CLI tab and copy and paste the `diff` output to a text file for later usage. 
3. Go to the OSD tab and take a screenshot of the current layout
4. Flash INAV 2.1.0 enabling **full chip erase** . Now you FC should run INAV 2.0. Connect again and check the firmware version.
5. Go to the Mixer tab and load and apply your desired mixer.
6. Go back to your configuration text file and delete all lines starting with: mixer acczero accgain magzero osd. Adjust values to be adjusted noted in the release notes.
7. Open the CLI tab in the configurator and paste your cleaned up configuration in the text box and type `save` and press enter. The flight controller will now reboot.
8. Calibrate the accelerometer following the steps in the dedicated tab. Only first two steps need to be made in the right order.
9. Calibration of the magnetometer should be done at the field. The magnetic field indoors can be distorted and led to a bad calibration.
10. Restore manually your OSD layout using the screenshot and upload the font you like using the dedicated button.
11. Carefully check all the configuration and check on the bench without installed propellers if everything looks good. In particular, check if the model preview behaves correctly when you are moving your model and check surfaces movements for an airplane.
12. Enjoy INAV 2.1.0 and explore its new features!

## New targets:

* [Omnibus F4 Nano v6](https://inavflight.com/shop/s/bg/1320256)
* [Matek F722SE](https://inavflight.com/shop/s/bg/1379603)
* [DYS F4Pro v2](https://inavflight.com/shop/s/bg/1136875)
* [Kakute F7](https://inavflight.com/shop/s/bg/1317570)
* [Matek F411 RSSI](https://inavflight.com/shop/p/MATEKF411WING)
* [Matek F411 with second software serial](https://inavflight.com/shop/p/MATEKF411WING)
* SP Racing F7 Dual
* Kiss FC

## CLI:

### New

| Setting | Description |
| ----    | ------ |
|`fw_iterm_limit_stick_position` | |
| `nav_mc_braking_speed_threshold` | |
| `nav_mc_braking_disengage_speed` | |
| `nav_mc_braking_timeout` | |
| `nav_mc_braking_boost_factor` | |
| `nav_mc_braking_boost_timeout` | |
| `nav_mc_braking_boost_speed_threshold` | |
| `nav_mc_braking_boost_disengage_speed` | |
| `nav_mc_braking_bank_angle` | |
| `osd_artificial_horizon_max_pitch` | |
| `osd_failsafe_switch_layout` | |

### Removed

| Setting | Description |
| ----    | ------ |
| `acc_task_frequency` | |
| `attitude_task_frequency` | |
| `async_mode` | |

## Main changes

### Multirotor braking mode

#### Requirements and setup

1. Multirotor has to be capable of running 3D Position Hold: GPS, Compass, and Baro are required
1. `MC BRAKING` flight mode has to be enabled
1. UAV has to be put into User Control Mode ***CRUISE***

![01](https://user-images.githubusercontent.com/966811/45925090-1c005a80-bf0f-11e8-85a1-fce9537ee3b8.PNG)

![02](https://user-images.githubusercontent.com/966811/45925091-1dca1e00-bf0f-11e8-8f20-416eb603107b.PNG)

#### Settings

* `nav_mc_braking_speed_threshold` - min speed in cm/s above which braking can happen
* `nav_mc_braking_disengage_speed` - braking is disabled when speed goes below this value
* `nav_mc_braking_timeout` - timeout in ms for braking
* `nav_mc_braking_boost_factor` - acceleration factor for `BOOST` phase
* `nav_mc_braking_boost_timeout` - how long in ms `BOOST` phase can happen
* `nav_mc_braking_boost_speed_threshold` - `BOOST` can be enabled when speed is above this value
* `nav_mc_braking_boost_disengage_speed` - `BOOST` will be disabled when speed goes below this value
* `nav_mc_braking_bank_angle` - max angle that MR is allowed to bank in BOOST mode

#### How it works:

1. There are two phases `BRAKE` and `BOOST`
1. `BRAKE` can be started then `MC BRAKING` mode is enabled, MR is in `CRUISE` mode, `3D PosHold` is enabled, MR is traveling above `nav_mc_braking_speed_threshold` and pilot releases sticks
1. INAV will store new PosHold position only when copter will stop, not when stricks are released
1. On top of that, `BOOST` phase can be enabled if MR is traveling above `nav_mc_braking_boost_speed_threshold`
1. in `BOOST` phase, MR is allowed to use higher acceleration and banking angle than normal. 
1. Because `BOOSTS` is limited in time, banking angle much higher than default should be fine

#### Tuning

Default values should be pretty safe to use. My 6" machine using following values:

```
set nav_mc_braking_speed_threshold = 100
set nav_mc_braking_disengage_speed = 50
set nav_mc_braking_timeout = 2000
set nav_mc_braking_boost_factor = 150
set nav_mc_braking_boost_timeout = 1000
set nav_mc_braking_boost_speed_threshold = 120
set nav_mc_braking_boost_disengage_speed = 75
set nav_mc_braking_bank_angle = 40
```

## All changes:

* [1.5s Throttle Rampup for Autolaunch](https://github.com/iNavFlight/inav/pull/4082)
* [option to switch to default OSD layout during failsafe](https://github.com/iNavFlight/inav/pull/4064)
* [debug raw accelerometer readouts](https://github.com/iNavFlight/inav/pull/4045)
* [log GPS velNED in Blackbox logs](https://github.com/iNavFlight/inav/pull/4044)
* [3D GPS speed in OSD](https://github.com/iNavFlight/inav/pull/3941)
* [On fixed wings limit Iterm based on stick position](https://github.com/iNavFlight/inav/pull/4023) 
* [PINIO support](https://github.com/iNavFlight/inav/pull/4011)
* [fix power level 5 to be a valid setting - allow setting max power on all VTXes](https://github.com/iNavFlight/inav/pull/4008)
* [default GPS baud rate bumped to 115200](https://github.com/iNavFlight/inav/pull/3995)
* [refactored SPI/SDCARD support](https://github.com/iNavFlight/inav/pull/3984)
* Gyro temperature in [OSD](https://github.com/iNavFlight/inav/pull/3978) and [Blackbox](https://github.com/iNavFlight/inav/pull/3979)
* [AK8975 enabled on OmnibusF4](https://github.com/iNavFlight/inav/pull/3966)
* [gyro_sync enabled by default on all supporting targets](https://github.com/iNavFlight/inav/pull/3931)
* [async gyro/acc/attitude tasks removed](https://github.com/iNavFlight/inav/pull/3930)
* [Crossfire telemetry updates](https://github.com/iNavFlight/inav/pull/3912)
* [DSHOT support](https://github.com/iNavFlight/inav/pull/3879)
* [Refactored Timer/DMA framework](https://github.com/iNavFlight/inav/pull/3833)
* [battery percentage based on sag compensated voltage](https://github.com/iNavFlight/inav/pull/3804)
* [CAMSTAB servo logic fixed](https://github.com/iNavFlight/inav/pull/3800)
* [refactored OSD flight time logic](https://github.com/iNavFlight/inav/pull/3790)
* [NMEA altitude bug fix](https://github.com/iNavFlight/inav/pull/3778)
* [Benewake TFmini lidar support](https://github.com/iNavFlight/inav/pull/3725)
* [Improved AHI](https://github.com/iNavFlight/inav/pull/3641)
* [Multirotor braking mode](https://github.com/iNavFlight/inav/pull/3159)